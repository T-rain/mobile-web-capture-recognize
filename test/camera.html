<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>

</head>
<body>
      <!--
      Ideally these elements aren't created until it's confirmed that the 
      client supports video/camera, but for the sake of illustrating the 
      elements involved, they are created with markup (not JavaScript)
    -->
    <video id="video" autoplay></video>
    <button id="snap">Snap Photo</button>
    <canvas id="canvas" width="640" height="480"></canvas>
    <script>

          

          window.addEventListener('DOMContentLoaded', function() {Video();}, false);


          
          // Setup the Audio and Video
          function Video() {
          var p = navigator.mediaDevices.getUserMedia({ audio: true, video: true });

          console.log(p);
          navigator.mediaDevices = navigator.mediaDevices || ((navigator.mozGetUserMedia || navigator.webkitGetUserMedia) ? {
               getUserMedia: function(c) {
                 return new Promise(function(y, n) {
                   (navigator.mozGetUserMedia ||
                    navigator.webkitGetUserMedia).call(navigator, c, y, n);
                 });
               }
            } : null);

            if (!navigator.mediaDevices) {
              console.log("getUserMedia() not supported.");
              return;
            }

            // Prefer camera resolution nearest to 1280x720.

            var constraints = { video: true };
            console.log(constraints);
            console.log(navigator.mediaDevices.getUserMedia(constraints).then());

            navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {
              
              var video = document.getElementById('video');
              video.src = window.URL.createObjectURL(stream);
              video.onloadedmetadata = function(e) {

                video.play();
              };
            })
            .catch(function(err) {
              console.log(err.name + ": " + err.message);
            });
          }

    </script>
    <!--
    <script>
    alert("hello");
          // Put event listeners into place
    window.addEventListener("DOMContentLoaded", function() {
      alert("hi");
      // Grab elements, create settings, etc.
      var canvas = document.getElementById("canvas"),
        context = canvas.getContext("2d"),
        video = document.getElementById("video"),
        videoObj = { "video": true },
        errBack = function(error) {
          console.log("Video capture error: ", error.code); 
        };

      // Put video listeners into place
      if(navigator.getUserMedia) { // Standard
        navigator.getUserMedia(videoObj, function(stream) {
          video.src = stream;
          video.play();
        }, errBack);
      } else if(navigator.webkitGetUserMedia) { // WebKit-prefixed
        alert("hi1");
        navigator.webkitGetUserMedia(videoObj, function(stream){
          alert("hi2");
          video.src = window.webkitURL.createObjectURL(stream);
          video.play();
        }, errBack);
      }
      else if(navigator.mozGetUserMedia) { // Firefox-prefixed
        navigator.mozGetUserMedia(videoObj, function(stream){
          video.src = window.URL.createObjectURL(stream);
          video.play();
        }, errBack);
      }
    }, false);

  </script>
  -->
</body>
</html>